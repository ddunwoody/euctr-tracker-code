{% extends "base.html" %}

{% block title %}Is {{ sponsor_name }} late reporting EU clinical trials?{% endblock %}

{% block content %}

  <div class="container">
    <div class="page-header">
      <h1>{{ sponsor_name }}{% if sponsor_name|slice:"-1:" == "s" %}'{% else %}'s{% endif %}
	EU clinical trials</h1>
    </div>

    <div class="row headline-box" id="sponsor-headlines">
      <div class="col-md-7">
	<p class="lead">Out of <b>{{total_due}} <span title="Trials which are listed as completed with a completion date, and the date is more than a year ago" data-toggle="tooltip" data-placement="bottom">due 
	    trial{{total_due|pluralize}}</span></b> 
	in the
	<a href="https://www.clinicaltrialsregister.eu/">European Union Clinical Trials Register (EUCTR)</a>,
	{% if total_unreported == total_due %}
	  sponsor {{ sponsor_name }} are late reporting
	  <b>all of them</b>.
	{% elif total_unreported == 0 %}
	  the sponsor {{ sponsor_name }} has reported 
	  <b>all on time</b>.
	{% else %}
	  sponsor {{ sponsor_name }} are late reporting
	  <b>{{total_unreported}} trial{{total_unreported|pluralize}}</b>.
	{% endif %}
	</p>
      </div>
      <div class="col-md-5 second-column">
	<div class="headline-number">{{percent_unreported}}%</div>
	<p class="lead"> of trials <b>breaking the law</b></p>
      </div>
    </div>
    {% if inconsistent_trials > 0 %}
    <div class="row">
      <div class="col-md-7">
	<p>In addition <b>{{inconsistent_trials}} trial{{inconsistent_trials|pluralize}}</b> 
	have <b>inconsistent</b> data. 
	Many of these trials may also need to report results to obey the law. You can look up
	the specific overdue or inconsistent trials in the list below.
	</p>
      </div>
    </div>
    {% endif %}
  </div>

  <div class="container">
    <div id="trials_table_loading">
      <span class="glyphicon glyphicon-refresh spinning"></span>
    </div>
   
    <ul class="nav nav-tabs nav-justified" id="table-pills">
      <li id="due_trials" role="presentation" class="active" title="" data-toggle="xtooltip" data-placement="bottom">
	<a href="#">Due trials<span class="badge">{{ total_due }}</span></a>
      </li>
      <li id="not_yet_due_trials" role="presentation" title="" data-toggle="xtooltip" data-placement="bottom">
	<a href="#">Not yet due<span class="badge">{{ not_yet_due_trials }}</span></a>
      </li>
      <li id="bad_data_trials" role="presentation" title="" data-toggle="xtooltip" data-placement="bottom">
	<a href="#">Bad data<span class="badge">{{ inconsistent_trials }}</span></a>
      </li>
      <li id="search_trials" role="presentation">
	<a href="#">
	<div class="input-group">
	  <input type="text" class="form-control" placeholder="Search">
	  <span class="input-group-btn">
	    <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
	    <div class="spacer">
	      <span class="badge">{{ 99 }}</span>
	    </div>
	  </span>
	</div>
      </a></li>
    </ul>

    <h2>Trials that are late</h2>
    <p>
    These trials completed more than 12 months ago and should have reported
    results. Some have, some have not. The individual trials are identified below
    </p>



    <table id="trials_table" class="display" cellspacing="0" width="100%">
      <script>
        hide_trials_datatable()
      </script>

      <thead>
        <tr>
          <th>Status</th>
          <th>Trial ID</th>
          <th>Title</th>
          <th>Completion date</th>
	  <th class="hidden_column">Category</th>
        </tr>
      </thead>

      {% for trial in trials %}
        {% if trial.has_results == 0 %}
        <tr class="no_results">
        {% else %}
        <tr>
        {% endif %}
          <td>
	    <!-- Due -->
	    {% if trial.overall_status == "reported" %}
	      <span class="label label-success">
	      Reported results</span></span>
	    {% elif trial.overall_status == "completed-due" %}
	      <span class="label label-danger">
	      Not reported</span>

	    <!-- Not yet due -->
	    {% elif trial.overall_status == "ongoing" %}
	      <span class="label label-default">
	      Ongoing</span>
	    {% elif trial.overall_status == "ongoing-reported-early"%}
	      <span class="label label-default">
	      Completed and reported early</span>
	    {% elif trial.overall_status == "completed-not-due" %}
	      <span class="label label-info">
	      Completed and not yet due</span>
	    {% elif trial.overall_status == "completed-reported-early"%}
	      <span class="label label-default">
	      Completed and reported early</span>
	    {% elif trial.overall_status == "other" %}
	      <span class="label label-info"> <!-- XXX white -->
	      Other</span>

	    <!-- Bad data -->
	    {% elif trial.overall_status == "error-ongoing-has-comp-date" %}
	      <span class="label label-danger">
	      Ongoing yet has completion date</span>
	      {% if trial.has_results%}<br>Also reported results{% endif %}
	    {% elif trial.overall_status == "error-completed-no-comp-date" %}
	      <span class="label label-danger">
	      Completed but no date</span>
	      {% if trial.has_results%}<br>Also reported results{% endif %}
	    {% elif trial.overall_status == "no-trial-status" %}
	      <span class="label label-default">
	      No trial status on register</span>
	    {% else %}
	      EU Trials Tracker internal error &mdash; {{ trial.overall_status }}
	    {% endif %}
	 </td>

	  <td><a href="{{ trial.trial_url}}">{{ trial.trial_id }}</a></td>
          <td>{{ trial.trial_title }}</td>

          <td>{{ trial.max_end_date | default_if_none:"-"}}</td>

	  <td class="hidden_column">
	    <!-- Due -->
	    {% if trial.overall_status == "reported" %}
	      due-trials
	    {% elif trial.overall_status == "completed-due" %}
	      due-trials
	    <!-- Not yet due -->
	    {% elif trial.overall_status == "ongoing" %}
	      not-yet-due
	    {% elif trial.overall_status == "ongoing-reported-early"%}
	      not-yet-due
	    {% elif trial.overall_status == "completed-not-due" %}
	      not-yet-due
	    {% elif trial.overall_status == "completed-reported-early"%}
	      not-yet-due
	    {% elif trial.overall_status == "other" %}
	      not-yet-due
	    <!-- Bad data -->
	    {% elif trial.overall_status == "error-ongoing-has-comp-date" %}
	      bad-data
	    {% elif trial.overall_status == "error-completed-no-comp-date" %}
	      bad-data
	    {% elif trial.overall_status == "no-trial-status" %}
	      bad-data
	    {% else %}
	      bad-data
	    {% endif %}
        </tr>
      {% endfor %}
    </table>

    <script>
      activate_trials_datatable()
    </script>

  </div>


{% endblock%}
