{% load render_nan %}
{% load bar_chart %}

<script>
  total_unreported = {{ total_unreported }}
  total_reported = {{ total_reported }}
  total_due = {{ total_due }}
  not_yet_due_trials = {{ not_yet_due_trials }}
  inconsistent_trials = {{ inconsistent_trials }}
  total_trials = {{ total_trials }}
</script>

<div class="container">
  <div class="page-header">
    <h1>{{ sponsor_name }}{% if sponsor_name|slice:"-1:" == "s" %}'{% else %}'s{% endif %}
      EU clinical trials</h1>
  </div>

  {% if total_trials > 0 %}
  <div class="row">
    <div class="col-sm-3 col-xs-6 sponsor-headlines">
      <canvas id="unreported_chart" height="200px"></canvas>
      {% if percent_unreported == 0 %}
	<div class="sponsor-number">All</div>
	<p class="lead">of {{ sponsor_name }}'s {{ total_due }} due trials 
	have been reported</p>
      {% elif percent_unreported == 100 %}
	<div class="sponsor-number">None</div>
	<p class="lead">of {{ sponsor_name }}'s {{ total_due }} due trials 
	have been reported</p>
      {% elif percent_unreported|custom_percent == "-" %}
	<div class="sponsor-number">&nbsp;</div>
	<p class="lead">{{ sponsor_name }} has no due trials, so none
	are late reporting</p>
      {% else %}
	<div class="sponsor-number">{{percent_unreported | custom_percent}}</div>
	<p class="lead">of {{ sponsor_name }}'s {{ total_due}} due trials 
	<b>are late reporting</b>
	</p>
      {% endif %}
    </div>
    <div class="col-sm-3 col-sm-push-6 col-xs-6 sponsor-headlines">
      <div class="sponsor-number">{{inconsistent_trials}}</div>
      <p class="lead">of {{ sponsor_name }}'s {{ total_trials }} register entries
      have <b>inconsistent data</b>, so we can't be sure if they've reported
      on time</p>
    </div>
    <div class="col-sm-6 col-sm-pull-3 col-xs-12 sponsor-headlines">
      <div id="trials-bar-chart">
	<div id="not-reported-bar" style="height: {% calc_bar total_due not_yet_due_trials inconsistent_trials %}%" data-toggle="tooltip" data-placement="bottom" title="Due to report, but not reported: {{ total_unreported }} trials">
	</div>
	<div id="reported-bar" style="height: {% calc_bar total_reported total_due not_yet_due_trials inconsistent_trials %}%" data-toggle="tooltip" data-placement="bottom" title="Due to report, have reported: {{ total_reported }} trials">
	</div>
	<div id="not-due-bar" style="height: {% calc_bar not_yet_due_trials total_due inconsistent_trials %}%" data-toggle="tooltip" data-placement="bottom" title="Not yet due to report: {{ not_yet_due_trials }} trials">	</div>
	<div class="dashed-shadow" id="inconsistent-data-bar" style="height: {% calc_bar inconsistent_trials total_due not_yet_due_trials %}%" data-toggle="tooltip" data-placement="bottom" title="Inconsistent data: {{ inconsistent_trials }} trials">	</div>
      </div>
      <div id="trials-bar-caption">
	<span id="caption-1">Due trials</span>
	<span id="caption-2">Not due</span>
	<span id="caption-3">Inconsistent data</span>
      </div>
    </div>
    <div class="col-xs-12">
      <p class="lead sponsor-blurb">All clinical trials on the 
      <a href="https://www.clinicaltrialsregister.eu/">
	European Union Clinical Trials Register (EUCTR)
      </a>
      <b>must</b> report their results in the registry within a year of
      completion. This site tracks who's doing this and who isn't.
      <a href="/about">Learn more &raquo;</a>
      </p>
    </div>
   </div>

   <script>
   activate_charts()
   </script>
   {% endif %}
</div>



